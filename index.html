<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sz√≥dogAd√©l 1.0</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
.screen { display:none; padding:16px; }
.screen.active { display:block; }
button { padding:12px 16px; margin:8px 0; width:100%; font-size:16px; }
h1,h2,h3 { text-align:center; }
.progress { height:16px; background:#ddd; border-radius:8px; overflow:hidden; margin:8px 0; }
.progress > div { height:100%; width:0%; background:#4caf50; transition:width 0.3s; }
label { display:block; margin-top:12px; }
input, select { width:100%; padding:8px; font-size:16px; }
.card { background:white; padding:16px; border-radius:12px; }
.bad { background:#f44336 !important; color:white; }
</style>
</head>
<body>

<div id="menu" class="screen active">
  <h1>üìò Sz√≥dogAd√©l</h1>
  <button onclick="startPractice()">‚ñ∂Ô∏è Gyakorl√°s</button>
  <button onclick="showScreen('settings')">‚öôÔ∏è Be√°ll√≠t√°sok</button>
</div>

<div id="settings" class="screen">
  <h2>‚öôÔ∏è Be√°ll√≠t√°sok</h2>
  <div class="card">
    <label>1. f√°zis pontc√©l</label>
    <input type="number" id="p1" value="20" />
    <label>2. f√°zis pontc√©l</label>
    <input type="number" id="p2" value="20" />
    <label>3. f√°zis ‚Äì helyes szavak</label>
    <input type="number" id="p3" value="10" />
    <label>4. f√°zis ‚Äì sz√≥doga szavak</label>
    <input type="number" id="p4" value="10" />
    <button onclick="saveSettings()">üíæ Ment√©s</button>
    <button onclick="showScreen('menu')">‚¨ÖÔ∏è Vissza</button>
  </div>
</div>

<div id="practice" class="screen">
  <h2 id="phaseTitle"></h2>
  <div class="progress"><div id="phaseProgress"></div></div>
  <p id="scoreLine"></p>
  <div id="questionBox" class="card"></div>
</div>

<script>
const vocab = {
  "kutya":"dog","macska":"cat","h√°z":"house","aut√≥":"car","alma":"apple",
  "iskola":"school","asztal":"table","sz√©k":"chair","v√≠z":"water","keny√©r":"bread"
};

let settings = JSON.parse(localStorage.getItem('szodogadel_settings')) || {
  p1:20,p2:20,p3:10,p4:10
};

function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function saveSettings(){
  settings = {
    p1:+p1.value,p2:+p2.value,p3:+p3.value,p4:+p4.value
  };
  localStorage.setItem('szodogadel_settings', JSON.stringify(settings));
  alert("Mentve");
  showScreen('menu');
}

let phase=1,score=0,errors=0,hard={},current=null;

function startPractice(){
  phase=1;score=0;errors=0;hard={};
  showScreen('practice');
  document.getElementById('phaseTitle').textContent="1. f√°zis ‚Äì V√°laszt√°s";
  nextQ1();
}

function nextQ1(){
  const e=Object.entries(vocab);
  current=e[Math.floor(Math.random()*e.length)];
  let opts=[current[1]];
  while(opts.length<3){
    let r=e[Math.floor(Math.random()*e.length)][1];
    if(!opts.includes(r)) opts.push(r);
  }
  opts.sort(()=>Math.random()-0.5);
  scoreLine.innerHTML=`‚ùå ${errors} ‚≠ê ${score}/${settings.p1}`;
  questionBox.innerHTML="<h3>"+current[0]+"</h3>"+
    opts.map(o=>`<button onclick="ans1('${o}',this)">${o}</button>`).join('');
  phaseProgress.style.width=(score/settings.p1*100)+"%";
}

function ans1(sel,btn){
  if(sel===current[1]){
    score++;
    if(score>=settings.p1) return startPhase2();
    nextQ1();
  } else {
    errors++; hard[current[0]]=(hard[current[0]]||0)+1;
    btn.classList.add("bad");
  }
}

function startPhase2(){
  phase=2;score=0;
  document.getElementById('phaseTitle').textContent="2. f√°zis ‚Äì Meger≈ës√≠t√©s";
  nextQ2();
}

function weighted(){
  let pool=[];
  Object.entries(vocab).forEach(([h,e])=>{
    pool.push([h,e]);
    if(hard[h]) for(let i=0;i<hard[h];i++) pool.push([h,e]);
  });
  return pool;
}

function nextQ2(){
  const pool=weighted();
  current=pool[Math.floor(Math.random()*pool.length)];
  let opts=[current[1]];
  const e=Object.entries(vocab);
  while(opts.length<3){
    let r=e[Math.floor(Math.random()*e.length)][1];
    if(!opts.includes(r)) opts.push(r);
  }
  opts.sort(()=>Math.random()-0.5);
  scoreLine.innerHTML=`‚úîÔ∏è ${score}/${settings.p2}`;
  questionBox.innerHTML="<h3>"+current[0]+"</h3>"+
    opts.map(o=>`<button onclick="ans2('${o}')">${o}</button>`).join('');
  phaseProgress.style.width=(score/settings.p2*100)+"%";
}

function ans2(sel){
  if(sel===current[1]){
    score++;
    if(score>=settings.p2) return startPhase3();
    nextQ2();
  }
}

let attempts=0;
function startPhase3(){
  phase=3;score=0;
  document.getElementById('phaseTitle').textContent="3. f√°zis ‚Äì √çr√°s";
  nextQ3();
}

function norm(s){return s.toLowerCase().replace(/\s+/g,'');}

function nextQ3(){
  attempts=0;
  const e=Object.entries(vocab);
  current=e[Math.floor(Math.random()*e.length)];
  scoreLine.innerHTML=`‚úçÔ∏è ${score}/${settings.p3}`;
  questionBox.innerHTML=`<h3>${current[0]}</h3>
    <input id="inp"><button onclick="chk3()">OK</button><p id="fb"></p>`;
  phaseProgress.style.width=(score/settings.p3*100)+"%";
}

function chk3(){
  const v=norm(inp.value),c=norm(current[1]);
  if(v===c){
    score++;
    if(score>=settings.p3) return startPhase4();
    nextQ3();
  } else {
    attempts++;
    fb.textContent=attempts>=5?("Helyes: "+current[1]):"Pr√≥b√°ld √∫jra";
  }
}

let exam=[];
function startPhase4(){
  phase=4;
  exam=Object.entries(vocab).sort(()=>Math.random()-0.5).slice(0,settings.p4);
  document.getElementById('phaseTitle').textContent="4. f√°zis ‚Äì Sz√≥doga";
  questionBox.innerHTML=`<form id="f">`+
    exam.map((w,i)=>`<label>${w[0]}</label><input data-i="${i}">`).join("")+
    `<button type="button" onclick="checkExam()">K√©sz</button></form>`;
  phaseProgress.style.width="100%";
}

function checkExam(){
  let ok=0,res="<h3>Eredm√©ny</h3><ul>";
  exam.forEach((w,i)=>{
    const v=norm(document.querySelector('[data-i="'+i+'"]').value);
    if(v===norm(w[1])) ok++;
    else res+=`<li>${w[0]} ‚Äì ${w[1]}</li>`;
  });
  res+="</ul>";
  const p=ok/exam.length*100;
  let g=p>=90?5:p>=75?4:p>=60?3:p>=40?2:1;
  questionBox.innerHTML=res+`<p>Oszt√°lyzat: <strong>${g}</strong></p>
  <button onclick="showScreen('menu')">üè† F≈ëmen√º</button>`;
}
</script>
</body>
</html>
